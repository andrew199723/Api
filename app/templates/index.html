{% extends "base.html" %}
{% block title %}Поиск деталей{% endblock %}
{% block content %}
	<h1>Поиск по артикулу</h1>
	<div class="card mt-3">
		<form method="get" action="/">
			<input class="input" type="text" name="article" placeholder="Введите артикул" value="{{ article }}" required />
			<div class="mt-3">
				<button class="btn primary" type="submit">Искать</button>
			</div>
		</form>
	</div>
	{% if article %}
		<h2 class="mt-4">Результаты</h2>
		<div class="card mt-2">
			{% if results|length == 0 and errors|length == 0 %}
				<div>Нет данных от поставщиков.</div>
			{% endif %}
			{% if results|length > 0 %}
				<table class="table">
					<thead>
						<tr>
							<th>Поставщик</th>
							<th>Артикул</th>
							<th>Название</th>
							<th>Цена</th>
							<th>Наличие</th>
							<th>Ссылка</th>
						</tr>
					</thead>
					<tbody>
						{% for row in results %}
							<tr>
								<td>{{ row.provider or '-' }}</td>
								<td>{{ row.article or '-' }}</td>
								<td>{{ row.title or row.name or '-' }}</td>
								<td>{{ row.price or '-' }}</td>
								<td>{{ row.stock or row.qty or '-' }}</td>
								<td>
									{% if row.url %}
										<a href="{{ row.url }}" target="_blank">Открыть</a>
									{% else %}-{% endif %}
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			{% endif %}
			{% if errors|length > 0 %}
				<div class="mt-3">
					<strong>Ошибки:</strong>
					<ul>
						{% for e in errors %}
							<li>{{ e.provider }}: {{ e.error }}</li>
						{% endfor %}
					</ul>
				</div>
			{% endif %}
		</div>
	{% endif %}
{% endblock %}