{% extends "base.html" %}
{% block title %}{{ 'Новый поставщик' if not provider else 'Редактирование' }}{% endblock %}
{% block content %}
	<h1>{{ 'Новый поставщик' if not provider else 'Редактирование' }}</h1>
	<div class="card mt-3">
		{% if error %}
			<div style="color:#dc2626; margin-bottom:10px;">{{ error }}</div>
		{% endif %}
		<form method="post" action="/providers/save">
			{% if provider %}
				<input type="hidden" name="provider_id" value="{{ provider.id }}" />
			{% endif %}
			<div class="mt-2">
				<label>Название</label>
				<input class="input" type="text" name="name" value="{{ provider.name if provider else '' }}" required />
			</div>
			<div class="mt-2">
				<label>Включен</label>
				<input type="checkbox" name="enabled" {% if provider and provider.enabled %}checked{% endif %} />
			</div>
			<div class="mt-2">
				<label>Метод</label>
				<select class="input" name="method">
					<option value="GET" {% if not provider or provider.method=='GET' %}selected{% endif %}>GET</option>
					<option value="POST" {% if provider and provider.method=='POST' %}selected{% endif %}>POST</option>
				</select>
			</div>
			<div class="mt-2">
				<label>URL шаблон (используйте {article})</label>
				<input class="input" type="text" name="url_template" value="{{ provider.url_template if provider else '' }}" placeholder="https://api.example.com/search?q={article}" required />
			</div>
			<div class="mt-2">
				<label>Заголовки (JSON)</label>
				<textarea class="input" name="headers_json" rows="4" placeholder='{"Authorization":"Bearer ..."}'>{{ provider.headers_json if provider and provider.headers_json else '' }}</textarea>
			</div>
			<div class="mt-2">
				<label>JMESPath выражение (возвращает список объектов)</label>
				<textarea class="input" name="jmespath_expr" rows="4" placeholder="items[*].{provider:'Name', article:id, title:name, price:price, stock:stock, url:url}">{{ provider.jmespath_expr if provider and provider.jmespath_expr else '' }}</textarea>
			</div>
			<div class="mt-2">
				<label>Таймаут (сек)</label>
				<input class="input" type="number" name="timeout_seconds" min="1" max="120" value="{{ provider.timeout_seconds if provider else 10 }}" required />
			</div>
			<div class="mt-3">
				<button class="btn primary" type="submit">Сохранить</button>
				<a class="btn" href="/providers">Отмена</a>
			</div>
		</form>
	</div>
{% endblock %}